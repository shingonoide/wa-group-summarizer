<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>WhatsApp Summarizer Settings</title>
    <style>
      :root {
        --primary: #25d366;
        --primary-hover: #128c7e;
        --danger: #dc3545;
        --danger-hover: #b02a37;
        --bg: #ffffff;
        --card-bg: #ffffff;
        --border: #e0e0e0;
        --text: #111827;
        --muted: #6b7280;
        --radius: 10px;
        --input-bg: #ffffff;
        --note-bg: #e8f5e9;
        --note-text: #1e8e3e;
        --saved-bg: #f9fafb;
        --saved-content-bg: #ffffff;
        --privacy-bg: #fdfdf6;
        --privacy-border: #facc15;
        --privacy-text: #854d0e;
        --danger-zone-bg: #fef2f2;
        --danger-zone-border: #fecaca;
        --danger-zone-text: #991b1b;
      }

      @media (prefers-color-scheme: dark) {
        :root {
          --primary: #25d366;
          --primary-hover: #34e879;
          --danger: #f87171;
          --danger-hover: #dc2626;
          --bg: #1a1a1a;
          --card-bg: #252525;
          --border: #3c4043;
          --text: #e8eaed;
          --muted: #9aa0a6;
          --input-bg: #2d2d2d;
          --note-bg: #1e3a25;
          --note-text: #81c995;
          --saved-bg: #2d2d2d;
          --saved-content-bg: #1a1a1a;
          --privacy-bg: #3a3520;
          --privacy-border: #fbbc04;
          --privacy-text: #fdd663;
          --danger-zone-bg: #3c2020;
          --danger-zone-border: #f87171;
          --danger-zone-text: #f87171;
        }
      }

      body {
        font-family: "Segoe UI", sans-serif;
        padding: 2em;
        max-width: 1100px;
        margin: auto;
        background-color: var(--bg);
        color: var(--text);
      }

      h1 {
        font-size: 1.7rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        text-align: center;
        color: var(--primary);
      }

      /* Layout */
      .grid {
        display: grid;
        gap: 2rem;
      }

      .grid-2 {
        grid-template-columns: 1fr;
      }

      @media (min-width: 900px) {
        .grid-2 {
          grid-template-columns: 1fr 1fr;
        }
      }

      /* Card style */
      .card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 1.25em;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.06);
      }

      .saved-message-card {
        max-height: 90vh;
        overflow-y: auto;
      }

      .card h3 {
        margin-top: 0;
        margin-bottom: 0.8em;
      }

      .form-group {
        margin-bottom: 1em;
      }

      label {
        display: block;
        margin-bottom: 0.4em;
        font-weight: 500;
      }

      input[type="text"],
      input[type="password"],
      select {
        width: 100%;
        padding: 10px;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-sizing: border-box;
        background-color: var(--input-bg);
        color: var(--text);
      }

      input[type="radio"],
      input[type="checkbox"] {
        accent-color: var(--primary);
      }

      .radio-group label {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-right: 1em;
        cursor: pointer;
      }

      .note {
        font-size: 0.9em;
        color: var(--note-text);
        background-color: var(--note-bg);
        padding: 0.5em;
        border-radius: var(--radius);
      }

      button {
        background-color: var(--primary);
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: var(--radius);
        cursor: pointer;
        font-weight: 500;
      }

      button:hover {
        background-color: var(--primary-hover);
      }

      #status {
        margin-top: 1em;
        font-weight: 600;
        color: var(--primary);
        text-align: center;
      }

      /* Saved Messages */
      .saved-message {
        padding: 10px;
        margin-bottom: 10px;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        background: var(--saved-bg);
      }

      .message-header {
        font-weight: 600;
        margin-bottom: 4px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .chat-title {
        font-weight: 600;
      }

      .message-count {
        font-size: 0.8em;
        color: var(--muted);
        font-weight: normal;
      }

      .message-content {
        white-space: pre-wrap;
        background-color: var(--saved-content-bg);
        color: var(--text);
        padding: 8px;
        border-radius: var(--radius);
        font-family: monospace;
        max-height: 150px;
        overflow-y: auto;
        border: 1px solid var(--border);
      }

      .message-meta {
        font-size: 0.8em;
        color: var(--muted);
        margin-top: 5px;
      }

      /* Privacy Notice */
      .privacy-notice {
        background-color: var(--privacy-bg);
        border: 1px solid var(--privacy-border);
      }

      .privacy-notice h3 {
        color: var(--privacy-text);
      }

      /* Danger Zone */
      .danger-zone {
        background-color: var(--danger-zone-bg);
        border: 1px solid var(--danger-zone-border);
      }

      .danger-zone h3 {
        color: var(--danger-zone-text);
      }

      .danger-zone button {
        background-color: var(--danger);
        margin-top: 0.5em;
      }

      .danger-zone button:hover {
        background-color: var(--danger-hover);
      }

      .delete-summary-btn {
        background-color: var(--danger);
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 0.8em;
        font-weight: 500;
        transition: background-color 0.2s;
      }

      .delete-summary-btn:hover {
        background-color: var(--danger-hover);
      }

      .danger-button {
        background-color: var(--danger);
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: var(--radius);
        cursor: pointer;
        font-weight: 500;
      }

      .danger-button:hover {
        background-color: var(--danger-hover);
      }
    </style>
  </head>

  <body>
    <h1>‚öôÔ∏è WhatsApp Summarizer Settings</h1>

    <!-- Row 1: Form + Saved Messages -->
    <div class="grid grid-2">
      <form id="options-form" class="card">
        <div class="form-group">
          <label for="apiKey">üîë Gemini API Key</label>
          <input type="password" id="apiKey" name="apiKey" required />
        </div>

        <div class="form-group">
          <label for="model">ü§ñ AI Model</label>
          <select id="model" name="model">
            <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite (Recommended)</option>
            <option value="gemini-2.5-flash">Gemini 2.5 Flash (Multimodal)</option>
            <option value="gemini-2.0-flash">Gemini 2.0 Flash</option>
          </select>
          <p class="note" style="margin-top: 8px;">Hover over models to see their capabilities.</p>
        </div>

        <div class="form-group">
          <label>üì© Default messages to summarize (N)</label>
          <div class="radio-group">
            <label><input type="radio" name="defaultN" value="50" /> 50</label>
            <label
              ><input type="radio" name="defaultN" value="100" /> 100</label
            >
            <label
              ><input type="radio" name="defaultN" value="200" /> 200</label
            >
            <label
              ><input type="radio" name="defaultN" value="300" /> 300</label
            >
          </div>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="saveSummaries" name="saveSummaries" />
            üíæ Save summaries to local history by default
          </label>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="includeMedia" name="includeMedia" />
            üñºÔ∏è Include images in summary by default
          </label>
          <p class="note" style="margin-top: 4px;">When enabled, images will be analyzed and described. Uses more API quota.</p>
        </div>

        <div class="form-group">
          <label>üåç Language Behavior</label>
          <p class="note">Summaries will be in the same language as the conversation.</p>
        </div>

        <div class="form-group">
          <label>üìù Summary length</label>
          <div class="radio-group">
            <label
              ><input type="radio" name="summaryLength" value="concise" />
              Concise</label
            >
            <label
              ><input type="radio" name="summaryLength" value="standard" />
              Standard</label
            >
            <label
              ><input type="radio" name="summaryLength" value="comprehensive" />
              Comprehensive</label
            >
          </div>
          <p class="note">
            Concise: 2-3 sentences. Standard: 3-5 sentences + bullets.
            Comprehensive: detailed summary with more bullets.
          </p>
        </div>

        <button type="submit">üíæ Save Settings</button>
        <div id="status"></div>
      </form>

      <div class="card saved-message-card">
        <h3>üìÇ Saved Messages</h3>
        <div id="saved-messages-list">
          <!-- Saved messages will be inserted here -->
        </div>
      </div>
    </div>

    <!-- Row 2: Privacy Notice + Danger Zone -->
    <div class="grid grid-2" style="margin-top: 2rem">
      <div class="card privacy-notice">
        <h3>üîí Privacy Notice</h3>
        <p>
          Messages are sent to Google's Gemini API for processing. Your API key
          is stored securely in browser sync storage.
        </p>
        <p>
          You can choose to save summaries locally. This data is not synced and
          will be deleted if you clear browser data or uninstall the extension.
        </p>
      </div>

      <div class="card danger-zone">
        <h3>‚ö†Ô∏è Danger Zone</h3>
        <p>
          Delete all locally stored summaries. This action cannot be undone.
        </p>
        <button id="delete-all-summaries" class="danger-button">
          Delete All Summaries
        </button>
        <p style="margin-top: 16px;">
          Clear API quota state if you're stuck waiting.
        </p>
        <button id="clear-quota-btn" class="danger-button">
          Clear Quota State
        </button>
      </div>
    </div>

    <script type="module" src="options.js"></script>
  </body>
</html>
